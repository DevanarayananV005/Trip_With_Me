<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Package Manager </title>
    <link rel="icon" href="static/images/aes11.png" type="image/icon type">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='test_pack.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* Custom styles for the select box */
        .custom-select {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        /* Custom styles for the table */
        .custom-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .custom-table th, .custom-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .custom-table th {
            background-color: #f2f2f2;
        }

        .custom-table tr:hover {
            background-color: #f5f5f5;
        }

        .custom-table td {
            vertical-align: middle;
        }

        .custom-table td:last-child {
            text-align: center;
        }

        .custom-table .status-completed {
            color: green;
        }

        .custom-table .status-incomplete {
            color: red;
        }
        .dynamic-box {
            display: flex;
            justify-content: center;
            align-items: center;
            max-height: 600px; /* Adjust the height as needed */
            overflow-y: auto;
        }
        .dynamic-box form{
            width: 100%;
            border-collapse: collapse;
            margin-top: 400px;
        }
        .form-container {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .invalid-feedback {
            display: none;
        }
        .is-invalid + .invalid-feedback {
            display: block;
        }
    </style>
</head>
<body>
    <div class="admin-panel">
        <nav class="navbar">
            <img src="{{ url_for('static', filename='images/aes11.png') }}" alt="Company Logo" class="logo">
            <center><span style="margin-left: 402p"><b>Welcome, {{ c_name }}</b></span></center>
            <div class="user-menu">
                <img src="{{ url_for('static', filename='images/' + user_image) }}" alt="User" class="user-image" onclick="toggleDropdown()">
                <div class="dropdown-menu" id="dropdownMenu">
                    <a href="{{ url_for('logout') }}">Logout</a>
                    <li><a href="{{ url_for('updateuser') }}">Account Info</a></li>
                </div>
            </div>
        </nav>
        <div class="main">
            <nav class="sidebar" id="sidebar">
                <button class="togglebtn" onclick="toggleSidebar()">â˜°</button>
                <ul>
                    <li><a href="#" onclick="showSection('packages')"><i class="fas fa-calendar"></i> <span class="nav-text">Packages</span></a></li>
                    <li><a href="#" onclick="showSection('add_pack')"><i class="fas fa-tachometer"></i> <span class="nav-text">Dashboard</span></a></li>
                    <li><a href="#" onclick="showSection('users')"><i class="fas fa-users"></i> <span class="nav-text">Bookings</span></a></li>
                    <li><a href="#" onclick="showSection('reports')"><i class="fas fa-chart-line"></i> <span class="nav-text">Reports</span></a></li>
                </ul>
            </nav>
            <div class="content" id="content">
                <section id="packages" class="section active">  
                    <h1><b style="color:white;">Scheduled Packages</b></h1><br>
                    <div class="dynamic-box" id="scheduled-trip">
                        <table class="table table-borderless">
                            <thead>
                                <tr>
                                    <th>Sl. No</th>
                                    <th>Location</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                    <th>See Details</th>
                                    <th>Update</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for idx, trip in enumerate(trips) %}
                                <tr>
                                    <td>{{ idx + 1 }}</td>
                                    <td>{{ trip.location }}</td>
                                    <td>{{ trip.start_date }}</td>
                                    <td>{{ trip.end_date }}</td>
                                    <td>
                                        <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#detailsModal{{ idx }}">
                                            See Details
                                        </button>
                                        <!-- Modal -->
                                        <div class="modal fade" id="detailsModal{{ idx }}" tabindex="-1" aria-labelledby="detailsModalLabel{{ idx }}" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="detailsModalLabel{{ idx }}">Trip Details</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <table class="table table-borderless">
                                                            <tr>
                                                                <th>No of Participants</th>
                                                                <td>{{ trip.participants }}</td>
                                                            </tr>
                                                            <tr>
                                                                <th>Basic Amount</th>
                                                                <td>{{ trip.basic_amount }}</td>
                                                            </tr>
                                                            <tr>
                                                                <th>Tax Percentage</th>
                                                                <td>{{ trip.tax_percentage }}</td>
                                                            </tr>
                                                            <tr>
                                                                <th>Discount</th>
                                                                <td>{{ trip.discount }}</td>
                                                            </tr>
                                                            <tr>
                                                                <th>Bookings</th>
                                                                <td>{{ trip.bookings }}</td>
                                                            </tr>
                                                            <tr>
                                                                <th>Total Amount</th>
                                                                <td>{{ trip.basic_amount | float - ((trip.tax_percentage | float / 100) * trip.basic_amount | float) - ((trip.discount | float / 100) * trip.basic_amount | float) }}</td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#updateModal{{ idx }}" {% if trip.status != 0 %}disabled{% endif %}>
                                            Update
                                        </button>
                                        <!-- Update Modal -->
                                        <div class="modal fade" id="updateModal{{ idx }}" tabindex="-1" aria-labelledby="updateModalLabel{{ idx }}" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        
                                                        <h5 class="modal-title" id="updateModalLabel{{ idx }}">Update Trip</h5>
                                                    </div>
                                                    <div class="modal-body" style="margin-top: -404px;">
                                                        <form id="updateForm{{ idx }}" onsubmit="updateTrip(event, '{{ trip.id }}', {{ idx }})">
                                                            <div class="form-group">
                                                                <label for="updateLocation{{ idx }}">Location</label>
                                                                <input type="text" class="form-control" id="updateLocation{{ idx }}" name="location" value="{{ trip.location }}" readonly>
                                                                <div class="invalid-feedback">Location is required.</div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="updateStartDate{{ idx }}">Start Date</label>
                                                                <input type="date" class="form-control" id="updateStartDate{{ idx }}" name="start_date" value="{{ trip.start_date }}" required>
                                                                <div class="invalid-feedback">Start Date is required and must be after 5 days from today and within 2 years.</div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="updateEndDate{{ idx }}">End Date</label>
                                                                <input type="date" class="form-control" id="updateEndDate{{ idx }}" name="end_date" value="{{ trip.end_date }}" required>
                                                                <div class="invalid-feedback">End Date is required and must be after 2 days from the Start Date and within 4 months.</div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="updateBasicAmount{{ idx }}">Basic Amount</label>
                                                                <input type="number" class="form-control" id="updateBasicAmount{{ idx }}" name="basic_amount" value="{{ trip.basic_amount }}" required>
                                                                <div class="invalid-feedback">Basic Amount is required and must be a number with a maximum of 7 digits and should be greater than 100.</div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="updateTaxPercentage{{ idx }}">Tax Percentage</label>
                                                                <input type="number" class="form-control" id="updateTaxPercentage{{ idx }}" name="tax_percentage" value="{{ trip.tax_percentage }}" required>
                                                                <div class="invalid-feedback">Tax Percentage is required and must be a number between 0 and 20.</div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="updateDiscount{{ idx }}">Discount</label>
                                                                <input type="number" class="form-control" id="updateDiscount{{ idx }}" name="discount" value="{{ trip.discount }}" required>
                                                                <div class="invalid-feedback">Discount must be a number between 0 and 85.</div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="updateParticipants{{ idx }}">Participants</label>
                                                                <input type="number" class="form-control" id="updateParticipants{{ idx }}" name="participants" value="{{ trip.participants }}" required>
                                                                <div class="invalid-feedback">Number of Participants is required and must be a number with a maximum of 2 digits.</div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="updateDescription{{ idx }}">Description</label>
                                                                <textarea class="form-control" id="updateDescription{{ idx }}" name="description" required>{{ trip.description }}</textarea>
                                                                <div class="invalid-feedback">Description is required and must be between 50 and 700 characters.</div>
                                                            </div>
                                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                            <button type="submit" class="btn btn-primary">Update</button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <button type="button" class="btn {% if trip.status == 0 %}btn-success{% else %}btn-danger{% endif %}" onclick="toggleStatus('{{ trip.id }}', {{ trip.status }})">
                                            {% if trip.status == 0 %}Active{% else %}Deactive{% endif %}
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </section>
                <section id="add_pack" class="section">
                    <h1><b style="color:white;">Add Package</b></h1><br>
                    <div class="dynamic-box" id="add_pack">
                        <form id="tripForm" class="form-container" method="POST" action="{{ url_for('pack_manager') }}" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="location">Location</label>
                                <select id="location" name="location" class="form-control" required>
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                                <div class="invalid-feedback">Location is required.</div>
                            </div>
                            <div class="form-group">
                                <label for="startDate">Trip Start Date</label>
                                <input type="date" id="startDate" name="startDate" class="form-control" required>
                                <div class="invalid-feedback">Trip Start Date is required and must be after 5 days from today and within 2 years.</div>
                            </div>
                            <div class="form-group">
                                <label for="endDate">Trip End Date</label>
                                <input type="date" id="endDate" name="endDate" class="form-control" required>
                                <div class="invalid-feedback">Trip End Date is required and must be after 2 days from the Trip Start Date and within 4 months.</div>
                            </div>
                            <div class="form-group">
                                <label for="basicAmount">Basic Amount of the Trip</label>
                                <input type="number" id="basicAmount" name="basicAmount" class="form-control" required>
                                <div class="invalid-feedback">Basic Amount is required and must be a number with a maximum of 7 digits and should be greater than 100.</div>
                            </div>
                            <div class="form-group">
                                <label for="taxPercentage">Percentage of Tax</label>
                                <input type="number" id="taxPercentage" name="taxPercentage" class="form-control" required>
                                <div class="invalid-feedback">Percentage of Tax is required and must be a number between 0 and 20.</div>
                            </div>
                            <div class="form-group">
                                <label for="discount">Discount</label>
                                <input type="number" id="discount" name="discount" class="form-control" step="0.01" max="100">
                                <div class="invalid-feedback">Discount must be a number between 0 and 85.</div>
                            </div>
                            <div class="form-group">
                                <label for="participants">Number of Participants</label>
                                <input type="number" id="participants" name="participants" class="form-control" required>
                                <div class="invalid-feedback">Number of Participants is required and must be a number with a maximum of 2 digits.</div>
                            </div>
                            <div class="form-group">
                                <label for="description">Description and Requirements</label>
                                <textarea id="description" name="description" class="form-control" required></textarea>
                                <div class="invalid-feedback">Description and Requirements are required and must be between 50 and 700 letters.</div>
                            </div>
                            <div class="form-group">
                                <label for="image1">Location Image 1</label>
                                <input type="file" id="image1" name="image1" class="form-control" accept=".jpg, .jpeg, .png" required>
                                <div class="invalid-feedback">Location Image 1 is required and must be a jpg, jpeg, or png file.</div>
                            </div>
                            <div class="form-group">
                                <label for="image2">Location Image 2</label>
                                <input type="file" id="image2" name="image2" class="form-control" accept=".jpg, .jpeg, .png" required>
                                <div class="invalid-feedback">Location Image 2 is required and must be a jpg, jpeg, or png file.</div>
                            </div>
                            <div class="form-group">
                                <label for="image3">Location Image 3</label>
                                <input type="file" id="image3" name="image3" class="form-control" accept=".jpg, .jpeg, .png" required>
                                <div class="invalid-feedback">Location Image 3 is required and must be a jpg, jpeg, or png file.</div>
                            </div>
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </form>
                    </div>
                </section>
                <section id="users" class="section">
                    <h1><b style="color:white;">Bookings</b></h1><br>
                    <select id="location-select" class="form-select custom-select" aria-label="Select package">
                        <option selected>Select package</option>
                    </select>
                    <div class="dynamic-box" id="user-data">
                        <div style="text-align: right; margin-bottom: 20px;">
                            <a href="#" id="print-details" style="display: none;margin-bottom: 194px;margin-right: -1242px;">Print Details</a>
                        </div>
                        <table id="bookings-table" class="table custom-table" style="display: none;">
                            <thead>
                                <tr>
                                    <th>Sl. No</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Booking Date</th>
                                    <th>Booking Time</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Rows will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- <section id="companies" class="section">  
                    <h1><b style="color:white;">Scheduled Trip</b></h1><br>
                    <div class="dynamic-box" id="scheduled-trip">
                    </div>
                </section> -->
                <section id="reports" class="section">
                    <h1><b style="color:white;">Scheduled Trip</b></h1><br>
                    <div class="dynamic-box" id="scheduled-trip">
                    </div>
                </section>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('tripForm');
            const locationSelect = document.getElementById('location');
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            const basicAmountInput = document.getElementById('basicAmount');
            const taxPercentageInput = document.getElementById('taxPercentage');
            const discountInput = document.getElementById('discount');
            const participantsInput = document.getElementById('participants');
            const descriptionInput = document.getElementById('description');
            const imageInputs = document.querySelectorAll('input[type="file"]');
        
            // Fetch locations from REST API
            fetch('https://restcountries.com/v3.1/all')
                .then(response => response.json())
                .then(data => {
                    // Sort countries alphabetically by common name
                    const sortedCountries = data.sort((a, b) => {
                        const nameA = a.name.common.toUpperCase();
                        const nameB = b.name.common.toUpperCase();
                        if (nameA < nameB) {
                            return -1;
                        }
                        if (nameA > nameB) {
                            return 1;
                        }
                        return 0;
                    });
        
                    // Append sorted countries to the select element
                    sortedCountries.forEach(country => {
                        const option = document.createElement('option');
                        option.value = country.name.common;
                        option.textContent = country.name.common;
                        locationSelect.appendChild(option);
                    });
        
                    // Add a default empty option
                    const defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = 'Select a country';
                    defaultOption.selected = true;
                    defaultOption.disabled = true;
                    locationSelect.insertBefore(defaultOption, locationSelect.firstChild);
                });
        
            // Validation functions
            function validateLocation() {
                if (!locationSelect.value) {
                    locationSelect.classList.add('is-invalid');
                } else {
                    locationSelect.classList.remove('is-invalid');
                }
            }
        
            function validateStartDate() {
                const startDate = new Date(startDateInput.value);
                const today = new Date();
                const minStartDate = new Date(today.setDate(today.getDate() + 5));
                const maxStartDate = new Date(today.setFullYear(today.getFullYear() + 2));
                if (startDate < minStartDate || startDate > maxStartDate) {
                    startDateInput.classList.add('is-invalid');
                } else {
                    startDateInput.classList.remove('is-invalid');
                }
            }
        
            function validateEndDate() {
                const startDate = new Date(startDateInput.value);
                const endDate = new Date(endDateInput.value);
                const minEndDate = new Date(startDate.setDate(startDate.getDate() + 2));
                const maxEndDate = new Date(startDate.setMonth(startDate.getMonth() + 4));
                if (endDate < minEndDate || endDate > maxEndDate) {
                    endDateInput.classList.add('is-invalid');
                } else {
                    endDateInput.classList.remove('is-invalid');
                }
            }
        
            function validateBasicAmount() {
                if (!basicAmountInput.value || basicAmountInput.value.length > 7 || basicAmountInput.value < 100) {
                    basicAmountInput.classList.add('is-invalid');
                } else {
                    basicAmountInput.classList.remove('is-invalid');
                }
            }
        
            function validateTaxPercentage() {
                const value = parseFloat(taxPercentageInput.value);
                if (isNaN(value) || value < 0 || value > 20) {
                    taxPercentageInput.classList.add('is-invalid');
                } else {
                    taxPercentageInput.classList.remove('is-invalid');
                }
            }
        
            function validateDiscount() {
                if (discountInput.value && (discountInput.value < 0 || discountInput.value > 85)) {
                    discountInput.classList.add('is-invalid');
                } else {
                    discountInput.classList.remove('is-invalid');
                }
            }
        
            function validateParticipants() {
                if (!participantsInput.value || participantsInput.value.length > 2) {
                    participantsInput.classList.add('is-invalid');
                } else {
                    participantsInput.classList.remove('is-invalid');
                }
            }
        
            function validateDescription() {
                if (descriptionInput.value.length < 50 || descriptionInput.value.length > 700) {
                    descriptionInput.classList.add('is-invalid');
                } else {
                    descriptionInput.classList.remove('is-invalid');
                }
            }
            function areImagesSame(file1, file2) {
                    return file1 && file2 && file1.name === file2.name && file1.size === file2.size && file1.type === file2.type;
                }
        
            function validateImages() {
                    const image1 = imageInputs[0].files[0];
                    const image2 = imageInputs[1].files[0];
                    const image3 = imageInputs[2].files[0];

                    imageInputs.forEach(input => {
                        if (!input.value || !['image/jpeg', 'image/png'].includes(input.files[0].type)) {
                            input.classList.add('is-invalid');
                        } else {
                            input.classList.remove('is-invalid');
                        }
                    });

                    if (areImagesSame(image1, image2) || areImagesSame(image1, image3) || areImagesSame(image2, image3)) {
                        imageInputs.forEach(input => {
                            input.classList.add('is-invalid');
                        });
                        Swal.fire({
                            icon: 'error',
                            title: 'Images cannot be the same'
                        });
                    }
                }
            // Add keyup event listeners for validation
            locationSelect.addEventListener('change', validateLocation);
            startDateInput.addEventListener('keyup', validateStartDate);
            endDateInput.addEventListener('keyup', validateEndDate);
            basicAmountInput.addEventListener('keyup', validateBasicAmount);
            taxPercentageInput.addEventListener('keyup', validateTaxPercentage);
            discountInput.addEventListener('keyup', validateDiscount);
            participantsInput.addEventListener('keyup', validateParticipants);
            descriptionInput.addEventListener('keyup', validateDescription);
            imageInputs.forEach(input => input.addEventListener('change', validateImages));
        
            // Set default value for discount
            discountInput.addEventListener('blur', function() {
                if (!discountInput.value) {
                    discountInput.value = 0;
                }
            });
        
            // Form submission validation
            form.addEventListener('submit', function(event) {
                validateLocation();
                validateStartDate();
                validateEndDate();
                validateBasicAmount();
                validateTaxPercentage();
                validateDiscount();
                validateParticipants();
                validateDescription();
                validateImages();
        
                if (form.querySelectorAll('.is-invalid').length > 0) {
                    event.preventDefault();
                }
            });
        });
        
        function toggleStatus(tripId, currentStatus) {
            fetch(`/toggle_status/${tripId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ status: currentStatus })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const newStatus = currentStatus === 0 ? 1 : 0;
                    const message = newStatus === 0 ? 'Package Activated successfully' : 'Package Deactivated';
                    const icon = newStatus === 0 ? 'success' : 'warning';
        
                    Swal.fire({
                        icon: icon,
                        title: message
                    }).then(() => {
                        location.reload();
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error updating status'
                    });
                }
            });
        }
        
        function updateTrip(event, tripId, idx) {
            event.preventDefault();
            const form = document.getElementById(`updateForm${idx}`);
            const formData = new FormData(form);
        
            const tripData = {
                location: formData.get('location'),
                start_date: formData.get('start_date'),
                end_date: formData.get('end_date'),
                basic_amount: formData.get('basic_amount'),
                tax_percentage: formData.get('tax_percentage'),
                discount: formData.get('discount'),
                participants: formData.get('participants'),
                description: formData.get('description')
            };
        
            fetch(`/update_trip/${tripId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(tripData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Package updated successfully'
                    }).then(() => {
                        location.reload();
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error updating package'
                    });
                }
            });
        }
        </script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM fully loaded and parsed');
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            console.log('Flash messages:', {{ messages | tojson }});
            {% for category, message in messages %}
                console.log('Flash message:', '{{ category }}', '{{ message }}');
                Swal.fire({
                    icon: '{{ category }}',
                    title: '{{ message }}'
                });
            {% endfor %}
        {% endif %}
        {% endwith %}
    });
    </script>
    <!-- script for validation for update -->
    <script>
        function validateUpdateForm(idx) {
            const form = document.getElementById(`updateForm${idx}`);
            const locationInput = form.querySelector(`#updateLocation${idx}`);
            const startDateInput = form.querySelector(`#updateStartDate${idx}`);
            const endDateInput = form.querySelector(`#updateEndDate${idx}`);
            const basicAmountInput = form.querySelector(`#updateBasicAmount${idx}`);
            const taxPercentageInput = form.querySelector(`#updateTaxPercentage${idx}`);
            const discountInput = form.querySelector(`#updateDiscount${idx}`);
            const participantsInput = form.querySelector(`#updateParticipants${idx}`);
            const descriptionInput = form.querySelector(`#updateDescription${idx}`);

            function validateLocation() {
                if (!locationInput.value) {
                    locationInput.classList.add('is-invalid');
                } else {
                    locationInput.classList.remove('is-invalid');
                }
            }

            function validateStartDate() {
                const startDate = new Date(startDateInput.value);
                const today = new Date();
                const minStartDate = new Date(today.setDate(today.getDate() + 5));
                const maxStartDate = new Date(today.setFullYear(today.getFullYear() + 2));
                if (startDate < minStartDate || startDate > maxStartDate) {
                    startDateInput.classList.add('is-invalid');
                } else {
                    startDateInput.classList.remove('is-invalid');
                }
            }

            function validateEndDate() {
                const startDate = new Date(startDateInput.value);
                const endDate = new Date(endDateInput.value);
                const minEndDate = new Date(startDate.setDate(startDate.getDate() + 2));
                const maxEndDate = new Date(startDate.setMonth(startDate.getMonth() + 4));
                if (endDate < minEndDate || endDate > maxEndDate) {
                    endDateInput.classList.add('is-invalid');
                } else {
                    endDateInput.classList.remove('is-invalid');
                }
            }

            function validateBasicAmount() {
                if (!basicAmountInput.value || basicAmountInput.value.length > 7 || basicAmountInput.value < 100) {
                    basicAmountInput.classList.add('is-invalid');
                } else {
                    basicAmountInput.classList.remove('is-invalid');
                }
            }

            function validateTaxPercentage() {
                const value = parseFloat(taxPercentageInput.value);
                if (isNaN(value) || value < 0 || value > 20) {
                    taxPercentageInput.classList.add('is-invalid');
                } else {
                    taxPercentageInput.classList.remove('is-invalid');
                }
            }

            function validateDiscount() {
                if (discountInput.value && (discountInput.value < 0 || discountInput.value > 85)) {
                    discountInput.classList.add('is-invalid');
                } else {
                    discountInput.classList.remove('is-invalid');
                }
            }

            function validateParticipants() {
                if (!participantsInput.value || participantsInput.value.length > 2) {
                    participantsInput.classList.add('is-invalid');
                } else {
                    participantsInput.classList.remove('is-invalid');
                }
            }

            function validateDescription() {
                if (descriptionInput.value.length < 50 || descriptionInput.value.length > 700) {
                    descriptionInput.classList.add('is-invalid');
                } else {
                    descriptionInput.classList.remove('is-invalid');
                }
            }

            // Add event listeners
            locationInput.addEventListener('change', validateLocation);
            startDateInput.addEventListener('change', validateStartDate);
            endDateInput.addEventListener('change', validateEndDate);
            basicAmountInput.addEventListener('change', validateBasicAmount);
            taxPercentageInput.addEventListener('change', validateTaxPercentage);
            discountInput.addEventListener('change', validateDiscount);
            participantsInput.addEventListener('change', validateParticipants);
            descriptionInput.addEventListener('change', validateDescription);

            // Form submission validation
            form.addEventListener('submit', function(event) {
                validateLocation();
                validateStartDate();
                validateEndDate();
                validateBasicAmount();
                validateTaxPercentage();
                validateDiscount();
                validateParticipants();
                validateDescription();

                if (form.querySelectorAll('.is-invalid').length > 0) {
                    event.preventDefault();
                }
            });
        }

        // Initialize validation for each update form
        document.addEventListener('DOMContentLoaded', function() {
            const updateForms = document.querySelectorAll('.modal-body form');
            updateForms.forEach((form, idx) => {
                validateUpdateForm(idx);
            });
        });
    </script>
   <script>
    document.addEventListener('DOMContentLoaded', function() {
        const locationSelect = document.getElementById('location-select');
        const printDetailsLink = document.getElementById('print-details');
        const bookingsTable = document.getElementById('bookings-table');
        const bookingsTableBody = bookingsTable.querySelector('tbody');
    
        // Function to fetch locations based on user_id
        function fetchLocations() {
            const user_id = '{{ session['user_id'] }}'; // Replace with actual session user_id
            fetch(`/get_locations?user_id=${user_id}`)
                .then(response => response.json())
                .then(data => {
                    locationSelect.innerHTML = '<option selected>Select package</option>';
                    data.forEach(location => {
                        const option = document.createElement('option');
                        option.value = location.trip_id;
                        option.textContent = location.location;
                        locationSelect.appendChild(option);
                    });
                });
        }
    
        // Function to fetch bookings based on trip_id
        function fetchBookings(trip_id) {
            fetch(`/get_bookings?trip_id=${trip_id}`)
                .then(response => response.json())
                .then(data => {
                    bookingsTableBody.innerHTML = '';
                    data.forEach((booking, index) => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${index + 1}</td>
                            <td>${booking.name}</td>
                            <td>${booking.email}</td>
                            <td>${booking.phone}</td>
                            <td>${booking.booking_date}</td>
                            <td>${booking.booking_time}</td>
                            <td style="color: ${booking.status == 1 ? 'green' : 'red'};">${booking.status == 1 ? 'Completed' : 'Incomplete'}</td>
                        `;
                        bookingsTableBody.appendChild(row);
                    });
                    bookingsTable.style.display = 'table';
                    printDetailsLink.style.display = 'block'; // Show the "Print Details" link
                });
        }
    
        // Event listener for location select change
        locationSelect.addEventListener('change', function() {
            const selectedTripId = locationSelect.value;
            if (selectedTripId) {
                fetchBookings(selectedTripId);
            } else {
                bookingsTable.style.display = 'none';
                printDetailsLink.style.display = 'none'; // Hide the "Print Details" link
            }
        });
    
        // Fetch locations on page load
        fetchLocations();
    });
    </script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const printDetailsLink = document.getElementById('print-details');
            
                printDetailsLink.addEventListener('click', function(event) {
                    event.preventDefault();
                    generatePDF();
                });
            
                function generatePDF() {
                    const doc = new jspdf.jsPDF();
                    const table = document.getElementById('bookings-table');
                    const rows = table.querySelectorAll('tbody tr');
            
                    // Add header
                    doc.setFontSize(22);
                    doc.text('Trip With Me', 105, 20, { align: 'center' });
            
                    doc.setFontSize(18);
                    doc.text('{{ c_name }}', 105, 30, { align: 'center' });
            
                    const now = new Date();
                    const date = now.toLocaleDateString();
                    const time = now.toLocaleTimeString();
            
                    doc.setFontSize(12);
                    doc.text(`Date: ${date}`, 10, 40);
                    doc.text(`Time: ${time}`, 180, 40, { align: 'right' });
            
                    // Add table
                    const head = [['Sl. No', 'Name', 'Email', 'Phone', 'Booking Date', 'Booking Time', 'Status']];
                    const body = Array.from(rows).map(row => {
                        return Array.from(row.querySelectorAll('td')).map(cell => cell.innerText);
                    });
            
                    doc.autoTable({
                        startY: 50,
                        head: head,
                        body: body,
                        theme: 'grid',
                        styles: {
                            fontSize: 10,
                            cellPadding: 2,
                            lineColor: [0, 0, 0],
                            lineWidth: 0.1
                        },
                        headStyles: {
                            fillColor: [242, 242, 242],
                            textColor: [0, 0, 0],
                            halign: 'center'
                        },
                        bodyStyles: {
                            halign: 'center'
                        },
                        alternateRowStyles: {
                            fillColor: [255, 255, 255]
                        }
                    });
            
                    // Save the PDF
                    doc.save('bookings.pdf');
                }
            });
            </script>
</body>
</html>
