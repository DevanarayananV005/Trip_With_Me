<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='test_pack.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .dynamic-box {
            display: flex;
            justify-content: center;
            align-items: center;
            max-height: 600px; /* Adjust the height as needed */
            overflow-y: auto;
        }
        .dynamic-box form{
            width: 100%;
            border-collapse: collapse;
            margin-top: 400px;
        }
        .form-container {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .invalid-feedback {
            display: none;
        }
        .is-invalid + .invalid-feedback {
            display: block;
        }
    </style>
</head>
<body>
    <div class="admin-panel">
        <nav class="navbar">
            <img src="{{ url_for('static', filename='images/aes11.png') }}" alt="Company Logo" class="logo">
            <center><span style="margin-left: 402p"><b>PACKAGE MANAGER TERMINAL</b></span></center>
            <div class="user-menu">
                <img src="{{ url_for('static', filename='images/user.png') }}" alt="User" class="user-image" onclick="toggleDropdown()">
                <div class="dropdown-menu" id="dropdownMenu">
                    <a href="{{ url_for('logout') }}">Logout</a>
                </div>
            </div>
        </nav>
        <div class="main">
            <nav class="sidebar" id="sidebar">
                <button class="togglebtn" onclick="toggleSidebar()">â˜°</button>
                <ul>
                    <li><a href="#" onclick="showSection('add_pack')"><i class="fas fa-tachometer-alt"></i> <span class="nav-text">Dashboard</span></a></li>
                    <li><a href="#" onclick="showSection('users')"><i class="fas fa-users"></i> <span class="nav-text">Users</span></a></li>
                    <li><a href="#" onclick="showSection('settings')"><i class="fas fa-calendar"></i> <span class="nav-text">Schedule Trip</span></a></li>
                    <li><a href="#" onclick="showSection('companies')"><i class="fas fa-home"></i> <span class="nav-text">Companies</span></a></li>
                    <li><a href="#" onclick="showSection('reports')"><i class="fas fa-chart-line"></i> <span class="nav-text">Reports</span></a></li>
                </ul>
            </nav>
            <div class="content" id="content">
                <section id="add_pack" class="section active">
                    <h1><b style="color:white;">Add Package</b></h1><br>
                    <div class="dynamic-box" id="add_pack">
                        <form id="tripForm" class="form-container" method="POST" action="{{ url_for('pack_manager') }}" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="location">Location</label>
                                <select id="location" name="location" class="form-control" required>
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                                <div class="invalid-feedback">Location is required.</div>
                            </div>
                            <div class="form-group">
                                <label for="startDate">Trip Start Date</label>
                                <input type="date" id="startDate" name="startDate" class="form-control" required>
                                <div class="invalid-feedback">Trip Start Date is required and must be after 5 days from today and within 2 years.</div>
                            </div>
                            <div class="form-group">
                                <label for="endDate">Trip End Date</label>
                                <input type="date" id="endDate" name="endDate" class="form-control" required>
                                <div class="invalid-feedback">Trip End Date is required and must be after 2 days from the Trip Start Date and within 4 months.</div>
                            </div>
                            <div class="form-group">
                                <label for="basicAmount">Basic Amount of the Trip</label>
                                <input type="number" id="basicAmount" name="basicAmount" class="form-control" required>
                                <div class="invalid-feedback">Basic Amount is required and must be a number with a maximum of 7 digits.</div>
                            </div>
                            <div class="form-group">
                                <label for="taxPercentage">Percentage of Tax</label>
                                <input type="number" id="taxPercentage" name="taxPercentage" class="form-control" required>
                                <div class="invalid-feedback">Percentage of Tax is required and must be a number between 0 and 20.</div>
                            </div>
                            <div class="form-group">
                                <label for="discount">Discount</label>
                                <input type="number" id="discount" name="discount" class="form-control" step="0.01" max="100">
                                <div class="invalid-feedback">Discount must be a number between 0 and 100.</div>
                            </div>
                            <div class="form-group">
                                <label for="participants">Number of Participants</label>
                                <input type="number" id="participants" name="participants" class="form-control" required>
                                <div class="invalid-feedback">Number of Participants is required and must be a number with a maximum of 2 digits.</div>
                            </div>
                            <div class="form-group">
                                <label for="description">Description and Requirements</label>
                                <textarea id="description" name="description" class="form-control" required></textarea>
                                <div class="invalid-feedback">Description and Requirements are required and must be between 50 and 700 letters.</div>
                            </div>
                            <div class="form-group">
                                <label for="image1">Location Image 1</label>
                                <input type="file" id="image1" name="image1" class="form-control" accept=".jpg, .jpeg, .png" required>
                                <div class="invalid-feedback">Location Image 1 is required and must be a jpg, jpeg, or png file.</div>
                            </div>
                            <div class="form-group">
                                <label for="image2">Location Image 2</label>
                                <input type="file" id="image2" name="image2" class="form-control" accept=".jpg, .jpeg, .png" required>
                                <div class="invalid-feedback">Location Image 2 is required and must be a jpg, jpeg, or png file.</div>
                            </div>
                            <div class="form-group">
                                <label for="image3">Location Image 3</label>
                                <input type="file" id="image3" name="image3" class="form-control" accept=".jpg, .jpeg, .png" required>
                                <div class="invalid-feedback">Location Image 3 is required and must be a jpg, jpeg, or png file.</div>
                            </div>
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </form>
                    </div>
                </section>
                <section id="users" class="section">
                    <h1><b style="color:white;">User Data</b></h1><br>
                    <div class="dynamic-box" id="user-data">
                    </div>
                </section>
                <section id="settings" class="section">  
                    <h1><b style="color:white;">Scheduled Trip</b></h1><br>
                    <div class="dynamic-box" id="scheduled-trip">
                    </div>
                </section>
                <section id="companies" class="section">  
                    <h1><b style="color:white;">Scheduled Trip</b></h1><br>
                    <div class="dynamic-box" id="scheduled-trip">
                    </div>
                </section>
                <section id="reports" class="section">
                    <h1><b style="color:white;">Scheduled Trip</b></h1><br>
                    <div class="dynamic-box" id="scheduled-trip">
                    </div>
                </section>
            </div>
        </div>
    </div>
    <script>
     document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('tripForm');
        const locationSelect = document.getElementById('location');
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const basicAmountInput = document.getElementById('basicAmount');
        const taxPercentageInput = document.getElementById('taxPercentage');
        const discountInput = document.getElementById('discount');
        const participantsInput = document.getElementById('participants');
        const descriptionInput = document.getElementById('description');
        const imageInputs = document.querySelectorAll('input[type="file"]');

        // Fetch locations from REST API
        fetch('https://restcountries.com/v3.1/all')
            .then(response => response.json())
            .then(data => {
                // Sort countries alphabetically by common name
                const sortedCountries = data.sort((a, b) => {
                    const nameA = a.name.common.toUpperCase();
                    const nameB = b.name.common.toUpperCase();
                    if (nameA < nameB) {
                        return -1;
                    }
                    if (nameA > nameB) {
                        return 1;
                    }
                    return 0;
                });

                // Append sorted countries to the select element
                sortedCountries.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country.name.common;
                    option.textContent = country.name.common;
                    locationSelect.appendChild(option);
                });

                // Add a default empty option
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'Select a country';
                defaultOption.selected = true;
                defaultOption.disabled = true;
                locationSelect.insertBefore(defaultOption, locationSelect.firstChild);
            });

        // Validation functions
        function validateLocation() {
            if (!locationSelect.value) {
                locationSelect.classList.add('is-invalid');
            } else {
                locationSelect.classList.remove('is-invalid');
            }
        }

        function validateStartDate() {
            const startDate = new Date(startDateInput.value);
            const today = new Date();
            const minStartDate = new Date(today.setDate(today.getDate() + 5));
            const maxStartDate = new Date(today.setFullYear(today.getFullYear() + 2));
            if (startDate < minStartDate || startDate > maxStartDate) {
                startDateInput.classList.add('is-invalid');
            } else {
                startDateInput.classList.remove('is-invalid');
            }
        }

        function validateEndDate() {
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);
            const minEndDate = new Date(startDate.setDate(startDate.getDate() + 2));
            const maxEndDate = new Date(startDate.setMonth(startDate.getMonth() + 4));
            if (endDate < minEndDate || endDate > maxEndDate) {
                endDateInput.classList.add('is-invalid');
            } else {
                endDateInput.classList.remove('is-invalid');
            }
        }

        function validateBasicAmount() {
            if (!basicAmountInput.value || basicAmountInput.value.length > 7) {
                basicAmountInput.classList.add('is-invalid');
            } else {
                basicAmountInput.classList.remove('is-invalid');
            }
        }

        function validateTaxPercentage() {
            const value = parseFloat(taxPercentageInput.value);
            if (isNaN(value) || value < 0 || value > 20) {
                taxPercentageInput.classList.add('is-invalid');
            } else {
                taxPercentageInput.classList.remove('is-invalid');
            }
        }

        function validateDiscount() {
            if (discountInput.value && (discountInput.value < 0 || discountInput.value > 100)) {
                discountInput.classList.add('is-invalid');
            } else {
                discountInput.classList.remove('is-invalid');
            }
        }

        function validateParticipants() {
            if (!participantsInput.value || participantsInput.value.length > 2) {
                participantsInput.classList.add('is-invalid');
            } else {
                participantsInput.classList.remove('is-invalid');
            }
        }

        function validateDescription() {
            if (descriptionInput.value.length < 50 || descriptionInput.value.length > 700) {
                descriptionInput.classList.add('is-invalid');
            } else {
                descriptionInput.classList.remove('is-invalid');
            }
        }

        function validateImages() {
            imageInputs.forEach(input => {
                if (!input.value || !['image/jpeg', 'image/png'].includes(input.files[0].type)) {
                    input.classList.add('is-invalid');
                } else {
                    input.classList.remove('is-invalid');
                }
            });
        }

        // Add keyup event listeners for validation
        locationSelect.addEventListener('change', validateLocation);
        startDateInput.addEventListener('keyup', validateStartDate);
        endDateInput.addEventListener('keyup', validateEndDate);
        basicAmountInput.addEventListener('keyup', validateBasicAmount);
        taxPercentageInput.addEventListener('keyup', validateTaxPercentage);
        discountInput.addEventListener('keyup', validateDiscount);
        participantsInput.addEventListener('keyup', validateParticipants);
        descriptionInput.addEventListener('keyup', validateDescription);
        imageInputs.forEach(input => input.addEventListener('change', validateImages));

        // Set default value for discount
        discountInput.addEventListener('blur', function() {
            if (!discountInput.value) {
                discountInput.value = 0;
            }
        });

        // Form submission validation
        form.addEventListener('submit', function(event) {
            validateLocation();
            validateStartDate();
            validateEndDate();
            validateBasicAmount();
            validateTaxPercentage();
            validateDiscount();
            validateParticipants();
            validateDescription();
            validateImages();

            if (form.querySelectorAll('.is-invalid').length > 0) {
                event.preventDefault();
            }
        });
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM fully loaded and parsed');
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            console.log('Flash messages:', {{ messages | tojson }});
            {% for category, message in messages %}
                console.log('Flash message:', '{{ category }}', '{{ message }}');
                Swal.fire({
                    icon: '{{ category }}',
                    title: '{{ message }}'
                });
            {% endfor %}
        {% endif %}
        {% endwith %}
    });
    </script>
</body>
</html>
